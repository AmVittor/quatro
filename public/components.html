<!DOCTYPE html>
<html lang="pt">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CRUD</title>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
	<link rel="stylesheet" href="./css/sidebar.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="./assets/css/crud.css">
	<script type="text/javascript" src="./assets/js/funcoes.js"></script>

<body onload="verificar_autenticacao(), pegarIdServidor(idServer), listarComponents()">
	<div class="container-nav">
		<header class="site-header">
			<nav class="site-navigation">
				<div class="site-identity">
					<a href="./index.html"> <img src="./css/images/logo/logo-quatro-write-white.svg" alt=""></a>
				</div>
				<div class="hamburger">
					<div class="line1"></div>
					<div class="line2"></div>
					<div class="line3"></div>
				</div>
				<ul class="nav-links">
					<li><a href="./plans.html">Planos</a></li>
					<li><a href="./dashboard.html">Dashboard</a></li>
					<li><a href="./cadastro.html">Cadastro</a></li>
					<li><a href="./login.html">Login</a></li>
					<li><a href="./servers.html">Servidores</a></li>
				</ul>
			</nav>
		</header>
	</div>
	<div class="container">
		<div class="table-wrapper">
			<div class="table-title">
				<div class="row">
					<div class="col-sm-6">
						<h2>Gestão <b>Componentes</b></h2>
					</div>
					<div class="col-sm-6">
						<a href="#deleteEmployeeModal" class="btn btn-danger" data-toggle="modal"><i
								class="material-icons">&#xE15C;</i> <span>Remover Componente</span></a>
						<a href="#addEmployeeModal" class="btn btn-success" data-toggle="modal"><i
								class="material-icons">&#xE147;</i> <span>Adicionar Componente</span></a>
					</div>
				</div>
			</div>
			<table class="table table-striped table-hover">
				<thead>
					<tr>
						<th>
							<span class="custom-checkbox">
								<input type="checkbox" id="selectAll">
								<label for="selectAll"></label>
							</span>
						</th>
						<th>Item</th>
						<th>Tamanho</th>
						<th>Velocidade</th>
						<th>Temperatura</th>
						<th>UUID</th>
					</tr>
				</thead>
				<tbody id="div_lista">
					<!-- <tr>
						<td>
							<span class="custom-checkbox">
								<input type="checkbox" id="checkbox1" name="options[]" value="1">
								<label for="checkbox1"></label>
							</span>
						</td>
                        <td>Teste</td>
                        <td>teste@email.com</td>
                        <td>
                            <a href="#editEmployeeModal" class="edit" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Edit">&#xE254;</i></a>
                            <a href="#deleteEmployeeModal" class="delete" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Delete">&#xE872;</i></a>
                        </td>
                    </tr>  -->

				</tbody>
			</table>

		</div>
	</div>
	<div id="addEmployeeModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form id="form_cadastro" name="cadastro" onSubmit="cadastrar()">
					<div class="modal-header">
						<h4 class="modal-title">Adicionar Componente</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<select name="" id="sl_item" onchange="selecaoItem()">
							  <option value="undefined"> Selecione um Item</option>
							  <option value="cpu">CPU</option>
							  <option value="ram">RAM</option>
							  <option value="disco">Disco</option>
							</select>
							<input id="in_item" name="n_c_item" type="text" style="display: none;">
						</div>
						<div class="form-group">
							<label>Size</label>
							<input id="in_size" type="text" name="n_c_size" class="form-control" required>
						</div>
						<div class="form-group">
							<label>Speed</label>
							<input id="in_speed" type="text" name="n_c_speed" class="form-control" required>
						</div>
						<div class="form-group">
							<label>Temp. Máxima</label>
							<input id="in_temp" type="text" name="n_c_temp" class="form-control" required>
						</div>
						<div class="form-group">
							<label>UUID</label>
							<input id="in_uuid" type="text" name="n_c_uuid" class="form-control" required>
						</div>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
						<input type="submit" class="btn btn-success" value="Add">
					</div>
				</form>
			</div>
		</div>
	</div>
	<div id="editEmployeeModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form id="form_alterar" name="alterar">
					<div class="modal-header">
						<h4 class="modal-title">Editar Componente</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">
						<div class="modal-body">
							<div class="form-group">
								<select name="" id="sl_item_a" onchange="selecaoItem_a()">
								  <option value="undefined"> Selecione um Item</option>
								  <option value="cpu">CPU</option>
								  <option value="ram">RAM</option>
								  <option value="disco">Disco</option>
								</select>
								<input id="in_item_a" name="n_c_item_a" type="text" style="display: none;">
							</div>
							<div class="form-group">
								<label>Size</label>
								<input id="in_size_a" type="text" name="n_c_size_a" class="form-control" required>
							</div>
							<div class="form-group">
								<label>Speed</label>
								<input id="in_speed_a" type="text" name="n_c_speed_a" class="form-control" required>
							</div>
							<div class="form-group">
								<label>Temp. Máxima</label>
								<input id="in_temp_a" type="text" name="n_c_temp_a" class="form-control" required>
							</div>
							<div class="form-group">
								<label>UUID</label>
								<input id="in_uuid_a" type="text" name="n_c_uuid_a" class="form-control" required>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancelar">
						<input id="id_confirmacaoAlterar" type="submit" class="btn btn-info" value="Salvar">
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- Delete Modal HTML -->
	<div id="deleteEmployeeModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form id="form_delete" name="deletar">
					<div class="modal-header">
						<h4 class="modal-title">Deletar Componente</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">
						<p>Tem certeza que deseja deletar o componente?</p>
						<p class="text-warning"><small>Essa ação não pode ser desfeita</small></p>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancelar">
						<input id="id_confirmacaoDeletar" type="submit" class="btn btn-danger" value="Deletar">
					</div>
				</form>
			</div>
		</div>
	</div>
</body>

</html>
<script>
	$(document).ready(function () {
		// Activate tooltip
		$('[data-toggle="tooltip"]').tooltip();

		// Select/Deselect checkboxes
		$("#selectAll").click(function () {
			if (this.checked) {
				var list = document.querySelectorAll('input[type=checkbox]');
				Array.prototype.forEach.call(list, function (item) {
					item.checked = true;
				});
			} else {
				var list = document.querySelectorAll('input[type=checkbox]');
				Array.prototype.forEach.call(list, function (item) {
					item.checked = false;
				});
			}
		});

	});
	const body = document.querySelector('body'),
		sidebar = body.querySelector('nav'),
		toggle = body.querySelector(".toggle"),
		searchBtn = body.querySelector(".search-box"),
		modeSwitch = body.querySelector(".toggle-switch"),
		modeText = body.querySelector(".mode-text");


	toggle.addEventListener("click", () => {
		sidebar.classList.toggle("close");
	})

	searchBtn.addEventListener("click", () => {
		sidebar.classList.remove("close");
	})

	modeSwitch.addEventListener("click", () => {
		body.classList.toggle("dark");

		if (body.classList.contains("dark")) {
			modeText.innerText = "Light mode";
		} else {
			modeText.innerText = "Dark mode";

		}
	});
	
	function validaExcluir(){
	 	let totalItensCheckeds = $('input[type=checkbox]:checked').length;

	 	if(totalItensCheckeds == 0){
	 		window.alert("Selecione um/ou mais funcionários para excluir!");
			
	 	}

	 }
	 function validaEditar(){
	 	let totalItensCheckeds = $('input[type=checkbox]:checked').length;

	 	if (totalItensCheckeds > 1) {
	 		window.alert("Só é possível atualizar um funcionário por vez!");
			
	 	}else if(totalItensCheckeds == 0){
	 		window.alert("Selecione um funcionário para editar!");
			
	 	}

	}

	function selecaoItem(){
		in_item.value = sl_item.value;
		console.log("valor:",in_item.value)
		 }	 

	function selecaoItem_a(){
		in_item_a.value = sl_item_a.value;
		console.log("valor_a :",in_item_a.value)
	}

</script>
<script>
	let lista = [];

	function mudar() {
		var item = in_item_a.value;
		var size = in_size_a.value;
		var speed = in_speed_a.value;
		var temp = in_temp_a.value;
		var uuid = in_uuid_a.value;

		if (item.trim() == "" || size.trim() == "" || speed.trim() == "" || temp.trim() == "" || uuid.trim() == "") {
			window.alert("Preencha todos os campos/selecione para prosseguir!");
			limparFormulario();
			if (item.trim() == "") {
				console.log('item está em branco');
				limparFormulario();
			}

			if (size.trim() == "") {
				console.log('tamanho está em branco');
				limparFormulario();
			}
			if (speed.trim() == "") {
				console.log('velocidade está em branco')
				limparFormulario();
			}
			if (temp.trim() == "") {
				console.log('temperatura senha está em branco')
				limparFormulario();
			}
			if (uuid.trim() == "") {
				console.log('uuid senha está em branco')
				limparFormulario();
			}

			return false;
		}

		var list = document.querySelectorAll('input[type=checkbox]');
		let totalItensCheckeds = $('input[type=checkbox]:checked').length;

		if (totalItensCheckeds > 1) {
			window.alert("Só é possível atualizar um componente por vez!");
			return false;
		}
		if(totalItensCheckeds == 0){
			window.alert("Selecione um componente para editar!");
			return false;
		}

		for (var i = 1; list.length; i++) {
			if (list[i].checked == true) {
					let idAtual = list[i].id;

					var formulario = new URLSearchParams(new FormData(form_alterar));
					fetch(`/components/editar/${idAtual}`, {
						method: "PUT",
						body: formulario

					}).then(function (response) {
						if (response.ok) {
							console.log("Componente atualizados com sucesso!")
							window.location.href = "components.html"
						} else {

							console.log('Erro de cadastro!');
							response.text().then(function (resposta) {
								console.log(resposta);
							});
						}
					});

					return false;
			}
		}

	}

	function excluir() {
		var list = document.querySelectorAll('input[type=checkbox]');
		let totalItensCheckeds = $('input[type=checkbox]:checked').length;
		if(totalItensCheckeds == 0){
			window.alert("Selecione um/ou mais componentes para excluir!");
		}
		for (var i = 1; list.length; i++) {
			if (list[i].checked == true) {
				let idAtual = list[i].id;
				fetch(`/components/deletar/${idAtual}`, {
					method: "DELETE",
				}).then(function (resposta) {
					if (resposta.ok) {
						console.log("Componente deletado com sucesso!");
					} else {
						throw ('Houve um erro na API!');
					}
				}).catch(function (resposta) {
					console.error(resposta);
				});
			}
		}
		window.location.href = "components.html";
	}


	function listarComponents() {
		fetch("/components/")
			.then(function (resposta) {
				if (resposta.ok) {
					resposta.json().then(function (resposta) {
						console.log("Dados recebidos");

						var feed = document.getElementById("div_lista");
						div_lista.innerHTML = "";

						for (let i = 0; i < resposta.length; i++) {
							let dbo_components = resposta[i];

							// criando e manipulando elementos do HTML via JavaScript
							var trMain = document.createElement("tr");
							var tdMain = document.createElement("td");
							var spanCheckBox = document.createElement("span");
							var inputCheckBox = document.createElement("input");
							var labelCheckBox = document.createElement("label");
							var tdItem = document.createElement("td");
							var tdSize = document.createElement("td");
							var tdSpeed = document.createElement("td");
							var tdTemperature = document.createElement("td");
							var tdUUID = document.createElement("td");
							var tdCrud = document.createElement("td");
							var aEdit = document.createElement("a");
							var iEdit = document.createElement("i");
							var aDelete = document.createElement("a");
							var iDelete = document.createElement("i");


							tdItem.innerHTML = dbo_components.item;
							tdSize.innerHTML = dbo_components.size;
							tdSpeed.innerHTML = dbo_components.speed;
							tdTemperature.innerHTML =  dbo_components.temperature;
							tdUUID.innerHTML =  dbo_components.UUID;
							
							iEdit.innerHTML = "&#xE254;";
							iDelete.innerHTML = "&#xE872;";
							aDelete.setAttribute("data-toggle", "modal");
							spanCheckBox.className = "custom-checkbox";
							inputCheckBox.type = "checkbox";
							inputCheckBox.name = "options[]";
							inputCheckBox.setAttribute("value", "1");
							labelCheckBox.htmlFor = "checkbox1";
							aEdit.href = "#editEmployeeModal";
							aEdit.className = "edit";
							aDelete.id = "exibirModal1";
							aDelete.href = "#deleteEmployeeModal";
							aDelete.className = "delete";
							aEdit.setAttribute("data-toggle", "modal");
							iEdit.className = "material-icons";
							iEdit.setAttribute("data-toggle", "tooltip");
							iEdit.title = "Edit";
							iDelete.className = "material-icons";
							iDelete.setAttribute("data-toggle", "tooltip");
							iDelete.title = "Delete";

							id_confirmacaoAlterar.setAttribute("onclick", `mudar()`);
							id_confirmacaoDeletar.setAttribute("onclick", `excluir()`);

							aEdit.setAttribute("onclick", 'validaEditar()');
							aDelete.setAttribute("onclick", 'validaExcluir()');

							inputCheckBox.id = dbo_components.id_component;

							console.log(inputCheckBox.id);

							trMain.appendChild(tdMain);
							tdMain.appendChild(spanCheckBox);
							spanCheckBox.appendChild(inputCheckBox);
							spanCheckBox.appendChild(labelCheckBox);
							trMain.appendChild(tdItem);
							trMain.appendChild(tdSize);
							trMain.appendChild(tdSpeed);
							trMain.appendChild(tdTemperature);
							trMain.appendChild(tdUUID);
							trMain.appendChild(tdCrud);
							tdCrud.appendChild(aEdit);
							aEdit.appendChild(iEdit);
							tdCrud.appendChild(aDelete);
							aDelete.appendChild(iDelete);
							feed.appendChild(trMain);
						}


					});
				} else {
					throw ('Houve um erro na API!');
				}
			}).catch(function (resposta) {
				console.error(resposta);

			});
	}

	// Pegando ID do server

	var idServer = sessionStorage.servidor_id;

	console.log("Id do Servidor:" + idServer);

	function pegarIdServidor(idServer) {
		fetch(`/components/fk/${idServer}`, { cache: 'no-store' }).then(function (response) {

		});
	}


	function cadastrar() {
		var item = in_item.value;
		var size = in_size.value;
		var speed = in_speed.value;
		var temp = in_temp.value;
		var uuid = in_uuid.value;

		if (item.trim() == "" || size.trim() == "" || speed.trim() == "" || temp.trim() == "" || uuid.trim() == "") {
			window.alert("Preencha todos os campos/selecione para prosseguir!");
			limparFormulario();
			if (item.trim() == "") {
				console.log('item está em branco');
				limparFormulario();
			}

			if (size.trim() == "") {
				console.log('tamanho está em branco');
				limparFormulario();
			}
			if (speed.trim() == "") {
				console.log('velocidade está em branco')
				limparFormulario();
			}
			if (temp.trim() == "") {
				console.log('temperatura senha está em branco')
				limparFormulario();
			}
			if (uuid.trim() == "") {
				console.log('uuid senha está em branco')
				limparFormulario();
			}

			return false;
		}

		var formulario = new URLSearchParams(new FormData(form_cadastro));
		fetch("/components/cadastrar", {
			method: "POST",
			body: formulario
		}).then(function (response) {
			if (response.ok) {
				console.log("Componente cadastrado com sucesso!");
				window.location = "components.html";
			} else {

				console.log('Erro de cadastro!');
				response.text().then(function (resposta) {
					console.log(resposta);
				});
			}
		});

		return false;

	}

</script>